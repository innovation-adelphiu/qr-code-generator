<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>QR Code Generator</title>
    <script src="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    
    <style>
    body 
    {      
        display: flex;
        justify-content: center; /* horizontal center */
        flex-direction: column;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        font-weight: 800;
        background-color: #ccddee;
        line-height: 1.3;
        color: #000033;
    }

    .header
    {
        font-size: 36px;
        padding: 12px;
        text-align: center; 
    }

    .panel
    {
        background-color: #dddddd;
        border-radius: 12px;
        padding: 12px;
        margin: 6px;
        box-shadow: 0px 0px 4px rgba(0, 0, 0, 0.5);
    }

    .divPadding
    {
        padding-bottom: 8px;
    }

    .underline
    {
        text-decoration: underline;
    }

    select
    {
        padding: 6px;
        margin-right: 8px;
        border-radius: 4px;
    }

    input[type="checkbox"] 
    {
        transform: scale(1.5);      /* increase size */
        transform-origin: center;   /* keep it centered */
        cursor: pointer;
    }

    textarea 
    { 
        width: 95%; 
        height: 6em; /* approximately 6 lines */ 
        border-radius: 4px;
        padding: 4px;
    }

    button 
    { 
        background: #5f7a99;
        color: #FFFFFF;
        text-shadow: 1px 1px 1px #000000;
        letter-spacing: 1px;
        padding: 10px; 
        border: 1px solid #000066;
        border-radius: 10px;
        cursor: pointer;
        font-weight: bold;
        font-size: 1.2em;
        box-shadow: 0 1px 2px rgba(0,0,0,0.5);
        transition: 
            filter 0.2s ease,
            transform 0.2s ease,
            box-shadow 0.2s ease;
        width: 180px; 
        margin: 20px 15px 0px 15px;
    }

    button:hover
    {
        filter: brightness(1.2);         /* slightly brighter */
        transform: translateY(2px);       /* moves downward a bit */
        box-shadow: 0 2px 3px rgba(0,0,0,0.3); /* reduced shadow = “lower” look */
    }

    #columnContainer 
    {
        display: flex;          /* enables side-by-side layout */
        justify-content: space-between; /* optional: space between items */
        border: 0px solid gray;
        width: 900px;
        margin: 0 auto;
        text-align: center;
    }

    .column
    {
        border: 0px solid blue;
        width: 50%;
        padding: 12px;
    }

    #pdfOuterContainer
    {
        border: 2px dashed gray;
        display: inline-block;
        background-color: #FFFFFF;
    }

    #pdfScaleContainer
    {
        width: calc(7.5in * 0.50);
        height: calc(10.0in * 0.50);
    }

    #pdfPreviewArea 
    {
        border: 0px solid red;
        width: 7.5in;
        height: 10.0in; 
        display: flex;
        flex-direction: column;  /* stack vertically */
        gap: 0.25in;
        justify-content: center; /* centers horizontally */
        align-items: center;     /* centers vertically */
        text-align: center;
        white-space: pre-wrap;
        word-break: break-word;
        transform-origin: top left;
        transform: scale(0.50);
    }

    #pdfContentArea 
    {
        border: 0px dashed orange;
        border-radius: 0.5in;
        width: 7.5in;
        height: 10.0in; 
        display: flex; /* used when rendering pdf */
        flex-direction: column;  /* stack vertically */
        gap: 0.25in;
        justify-content: center; /* centers horizontally */
        align-items: center;     /* centers vertically */
        text-align: center;
        white-space: pre-wrap;
        word-break: break-word;
        display: none; /* at first, hide area used for generating */
    }

    #imgContentArea 
    {
        border: 0px dashed violet;
        display: flex;
        width: fit-content;    
        margin: 0px;
        padding: 0.1in;
        flex-direction: column;  /* stack vertically */
        gap: 0.25in;
        justify-content: right; /* centers horizontally */
        align-items: center;     /* centers vertically */
        text-align: center;
        white-space: pre-wrap;
        word-break: break-word;
        display: none; /* at first, hide area used for generating */
    }

  </style>
</head>

<body>
<div class="header">QR Code Generator</div>

<div id="columnContainer">
    <div id="leftColumn" class="column">

        <div class="panel">
            <div class="controls">
                <div class="divPadding underline">Upper Text Area</div>
                <div class="divPadding">
                    <label for="fontFamily1">Font</label>
                    <select id="fontFamily1">
                        <option value="Arial, Helvetica, sans-serif" selected>Arial</option>
                        <option value="'Comic Sans MS', 'Comic Sans', cursive">Comic Sans</option>
                        <option value="'Courier New', Courier, monospace">Courier New</option>
                        <option value="Garamond, serif">Garamond</option>
                        <option value="Georgia, serif">Georgia</option>
                        <option value="'Times New Roman', Times, serif">Times New Roman</option>
                        <option value="'Trebuchet MS', sans-serif">Trebuchet MS</option>
                        <option value="Verdana, Geneva, sans-serif">Verdana</option>
                    </select>
                    <label for="fontSize1">Size</label>
                    <select id="fontSize1">
                        <option>16</option><option selected>24</option><option>32</option>
                        <option>40</option><option>48</option><option>56</option><option>64</option>
                    </select>
                    <label for="fontBold1">Bold</label>
                    <input type="checkbox" id="fontBold1" />
                </div>
            </div>
            <textarea id="upperTextArea" placeholder="Enter your text here"></textarea><br>
        </div>

        <div class="panel">
            <div class="divPadding underline">QR Code Link</div>
            <textarea id="urlTextArea" placeholder="https://www.adelphi.edu" style="height: 2em;"></textarea>
        </div>

        <div class="panel">
            <div class="controls">
                <div class="divPadding underline">Lower Text Area</div>
                <div class="divPadding">
                    <label for="fontFamily2">Font</label>
                    <select id="fontFamily2">
                        <option value="Arial, Helvetica, sans-serif" selected>Arial</option>
                        <option value="'Comic Sans MS', 'Comic Sans', cursive">Comic Sans</option>
                        <option value="'Courier New', Courier, monospace">Courier New</option>
                        <option value="Garamond, serif">Garamond</option>
                        <option value="Georgia, serif">Georgia</option>
                        <option value="'Times New Roman', Times, serif">Times New Roman</option>
                        <option value="'Trebuchet MS', sans-serif">Trebuchet MS</option>
                        <option value="Verdana, Geneva, sans-serif">Verdana</option>
                    </select>
                    <label for="fontSize2">Size</label>
                    <select id="fontSize2">
                        <option>16</option><option selected>24</option><option>32</option>
                        <option>40</option><option>48</option><option>56</option><option>64</option>
                    </select>
                    <label for="fontBold2">Bold</label>
                    <input type="checkbox" id="fontBold2" />
                </div>
            </div>
            <textarea id="lowerTextArea" placeholder="Enter your text here"></textarea><br>
        </div>

        <button id="imageSaveButton">Save as Image</button>
        <button id="pdfSaveButton">Save as PDF</button>

    </div>
    <div id="rightColumn" class="column">

        <div class="panel">
            <div class="divPadding underline">PDF Page Preview</div>
                <div id="pdfOuterContainer">
                    <div id="pdfScaleContainer">
                        <div id="pdfPreviewArea"></div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<!-- invisible content areas -->
<div id="pdfContentArea"></div>
<div id="imgContentArea"></div>

<script>

// get HTML elements
const upperTextArea = document.getElementById("upperTextArea");
const urlTextArea = document.getElementById('urlTextArea');
const lowerTextArea = document.getElementById("lowerTextArea");
const pdfPreviewArea = document.getElementById("pdfPreviewArea");
const pdfContentArea = document.getElementById("pdfContentArea");
const imgContentArea = document.getElementById("imgContentArea");

const fontFamily1 = document.getElementById('fontFamily1');
const fontFamily2 = document.getElementById('fontFamily2');
const fontSize1 = document.getElementById('fontSize1');
const fontSize2 = document.getElementById('fontSize2');
const fontBold1  = document.getElementById('fontBold1');
const fontBold2  = document.getElementById('fontBold2');

const pdfSaveButton = document.getElementById('pdfSaveButton');
const imageSaveButton = document.getElementById('imageSaveButton');

upperTextArea.addEventListener('input', updatePreview);
fontFamily1.addEventListener('change', updatePreview);
fontSize1.addEventListener('change', updatePreview);
fontBold1.addEventListener('change', updatePreview);

urlTextArea.addEventListener('input', updatePreview);

lowerTextArea.addEventListener('input', updatePreview);
fontFamily2.addEventListener('change', updatePreview);
fontSize2.addEventListener('change', updatePreview);
fontBold2.addEventListener('change', updatePreview);

pdfSaveButton.addEventListener('click', savePDF);
imageSaveButton.addEventListener('click', saveImage);

function updatePreview()
{
    // clear previous contents
    pdfPreviewArea.innerHTML = "";
    pdfContentArea.innerHTML = "";
    imgContentArea.innerHTML = "";

    const upperText = upperTextArea.value;
    const urlText = urlTextArea.value.trim();
    const lowerText = lowerTextArea.value;

    // make sure there is something besides whitespace
    if ( upperText.trim() ) 
    {
        pdfPreviewArea.appendChild( createTextBlock(upperText, fontFamily1.value, fontSize1.value, fontBold1.checked) );
        pdfContentArea.appendChild( createTextBlock(upperText, fontFamily1.value, fontSize1.value, fontBold1.checked) );
        imgContentArea.appendChild( createTextBlock(upperText, fontFamily1.value, fontSize1.value, fontBold1.checked) );
    }
    if (urlText)       
    {
        pdfPreviewArea.appendChild( createQRBlock(urlText) );
        pdfContentArea.appendChild( createQRBlock(urlText) );
        imgContentArea.appendChild( createQRBlock(urlText) );
    }
    if ( lowerText.trim() ) 
    {
        pdfPreviewArea.appendChild( createTextBlock(lowerText, fontFamily2.value, fontSize2.value, fontBold2.checked) );
        pdfContentArea.appendChild( createTextBlock(lowerText, fontFamily2.value, fontSize2.value, fontBold2.checked) );
        imgContentArea.appendChild( createTextBlock(lowerText, fontFamily2.value, fontSize2.value, fontBold2.checked) );
    }

}

function createTextBlock(text, family, sizePt, isBold) 
{
    const div = document.createElement('div');
    div.className = 'block';
    div.style.fontFamily = family;
    div.style.fontSize = sizePt + 'pt';
    div.style.fontWeight = isBold ? 'bold' : 'normal';
    let t = text.replace(/\r\n/g, '\n');
    if (/\n$/.test(t)) 
        t += '\u00A0';    // preserve trailing newlines
    div.textContent = t;
    return div;
}

function createQRImageElement(text) 
{
    const sizeIn = 4; // width/height of square in inches
    const sizePx = Math.round(sizeIn * 96); // 4 inches * 96 px/in
    const div = document.createElement('div');
    new QRCode(div, {
        text,
        width: sizePx,
        height: sizePx,
        colorDark: "#000000",
        colorLight: "#ffffff",
        correctLevel: QRCode.CorrectLevel.M
    });
    const canvas = div.querySelector('canvas');
    const img = document.createElement('img');
    img.src = canvas.toDataURL('image/png');
    img.width = sizePx;
    img.height = sizePx;
    img.style.display = 'block';
    img.style.width = '4in';
    img.style.height = '4in';
    return img;
}

function createQRBlock(text) 
{
    const div = document.createElement('div');
    div.appendChild(createQRImageElement(text));
    return div;
}

function savePDF()
{
    const options = {
        margin: 0.45,
        filename: 'document.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2, scrollY: 0 },
        jsPDF: { unit: 'in', format: [8.5, 11.0], orientation: 'portrait' }
    };

    pdfContentArea.style.display = "flex"; // make visible temporarily
    
    // save to file
    html2pdf().set(options).from(pdfContentArea).save().then(pdf => {
        pdfContentArea.style.display = "none";
    });
    
    /*
    // preview in new browser tab
    html2pdf().set(options).from(pdfContentArea).toPdf().get('pdf').then(pdf => {
        pdfContentArea.style.display = "none";
        // Convert the generated PDF to a Blob
        const blob = pdf.output('blob');
        const url = URL.createObjectURL(blob);
        // Open in a new browser tab
        window.open(url, '_blank');
    });
    */
}

function saveImage()
{
    imgContentArea.style.display = "flex"; // make visible temporarily
    html2canvas(imgContentArea).then(function(canvas) {
        const link = document.createElement("a");
        link.download = "image.png";
        link.href = canvas.toDataURL("image/png");
        imgContentArea.style.display = "none";
        link.click();
    });
}

</script>
</body>
</html>
